<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard - Procrastination Timer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .streak-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff9d5c, #ffb366);
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            text-align: center;
            color: white;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            font-weight: 700;
            padding: 1rem 3rem;
            border-radius: 50px;
            border: 5px solid white;
            box-shadow: 
                0 8px 20px rgba(255, 157, 92, 0.5),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 1rem;
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% {transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .leaderboard-table {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 2fr 1fr 1.5fr 1.5fr;
            padding: 1rem;
            border-bottom: 1px solid #fff;
            align-items: center;
            transition: background 0.2s ease;
        }

        .leaderboard-row:hover {
            background: #fff3e6;
        }

        .leaderboard-row.header {
            background: linear-gradient(135deg, #ff9d5c, #ffb366);
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.2);
        }

        .leaderboard-row.header:hover {
            background: linear-gradient(135deg, #ff9d5c, #ffb366);
        }

        .rank {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }

        .rank.gold { color: #ffd700; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: shin2s infinite; }
        .rank.silver { color: #c0c0c0; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .rank.bronze { color: #cd7f32; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }

        @keyframes shine {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .score-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .score-excellent { background: #4caf50; color: white; }
        .score-good { background: #8bc34a; color: white; }
        .score-okay { background: #ffc107; color: white; }
        .score-poor { background: #ff9800; color: white; }
        .score-bad { background: #f44336; color: white; }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-family: 'Caveat', cursive;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="falling-leaves">
        <div class="leaf-fall" style="left: 10%; animation-delay: 0s;">üçÇ</div>
        <div class="leaf-fall" style="left: 30%; animation-delay: 3s;">üçÅ</div>
        <div class="leaf-fall" style="left: 50%; animation-delay: 6s;">üçÇ</div>
        <div class="leaf-fall" style="left: 70%; animation-delay: 2s;">üçÅ</div>
        <div class="leaf-fall" style="left: 85%; animation-delay: 8s;">üçÇ</div>
    </div>
    <div class="container">
        <div class="header">
            <h1>Your Leaderboard</h1>
            <div class="current-streak" id="streakDisplay">üî• 0 Day Streak</div>
        </div>

        <div class="summary-stats" id="summaryStats">
        </div>

        <div class="scrapbook-page">
            <h2>Last 7 Days Performance</h2>
            <div class="leaderboard-table">
                <div class="leaderboard-row header">
                    <div>Rank</div>
                    <div>Date</div>
                    <div>Score</div>
                    <div>Focus Time</div>
                    <div>Procrastination</div>
                </div>
                <div id="leaderboardBody">
                </div>
            </div>
        </div>

        <button onclick="window.location.href='index.html'">‚¨Ö Back</button>
    </div>

    <script>
        function isElectron() {
            return typeof window !== "undefined" && typeof window.process === "object" && window.process.type === "renderer";
        }

        const backBtn = document.getElementById("backBtn");
        const streakDisplay = document.getElementById("streakDisplay");
        const leaderboardBody = document.getElementById("leaderboardBody");
        const summaryStats = document.getElementById("summaryStats");

        // Get data from localStorage
        const weeklyStats = JSON.parse(localStorage.getItem("weeklyStats")) || [];
        const streak = parseInt(localStorage.getItem("streak")) || 0;

        // Display streak
        streakDisplay.textContent = `üî• ${streak} Day Streak`;

        // Calculate summary statistics
        function calculateSummaryStats() {
            if (weeklyStats.length === 0) return null;

            const last7Days = weeklyStats.slice(-7);
            const totalFocus = last7Days.reduce((sum, day) => sum + day.focus, 0);
            const totalProcrastination = last7Days.reduce((sum, day) => sum + day.procrastination, 0);
            const avgScore = Math.round(last7Days.reduce((sum, day) => sum + day.score, 0) / last7Days.length);
            const bestDay = last7Days.reduce((best, day) => day.score > best.score ? day : best, last7Days[0]);

            return { totalFocus, totalProcrastination, avgScore, bestDay };
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            if (h > 0) return `${h}h ${m}m`;
            return `${m}m`;
        }

        // Display summary stats
        const stats = calculateSummaryStats();
        if (stats) {
            summaryStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Focus (7d)</div>
                    <div class="stat-value">${formatTime(stats.totalFocus)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Score</div>
                    <div class="stat-value">${stats.avgScore}/100</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Day Score</div>
                    <div class="stat-value">${stats.bestDay.score}/100</div>
                </div>
            `;
        }

        // Get leaderboard data
        function getLeaderboardData() {
            const sortedStats = [...weeklyStats]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 7)
                .sort((a, b) => b.score - a.score); // Sort by score descending

            return sortedStats.map(day => ({
                date: new Date(day.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                score: day.score,
                focus: formatTime(day.focus),
                procrastination: formatTime(day.procrastination)
            }));
        }

        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 75) return 'score-good';
            if (score >= 60) return 'score-okay';
            if (score >= 40) return 'score-poor';
            return 'score-bad';
        }

        function getRankMedal(rank) {
            if (rank === 1) return '<span class="rank gold">ü•á</span>';
            if (rank === 2) return '<span class="rank silver">ü•à</span>';
            if (rank === 3) return '<span class="rank bronze">ü•â</span>';
            return `<span class="rank">${rank}</span>`;
        }

        // Display leaderboard
        const leaderboardData = getLeaderboardData();
        
        if (leaderboardData.length === 0) {
            leaderboardBody.innerHTML = '<div class="no-data">No data yet. Complete some focus sessions to see your stats!</div>';
        } else {
            leaderboardBody.innerHTML = leaderboardData.map((day, index) => `
                <div class="leaderboard-row">
                    <div>${getRankMedal(index + 1)}</div>
                    <div>${day.date}</div>
                    <div><span class="score-badge ${getScoreClass(day.score)}">${day.score}/100</span></div>
                    <div>${day.focus}</div>
                    <div>${day.procrastination}</div>
                </div>
            `).join('');
        }

        // Navigation
        if (isElectron()) {
            const { ipcRenderer } = require("electron");
            backBtn.addEventListener("click", () => {
                ipcRenderer.send("navigate", "index.html");
            });
        } else {
            backBtn.addEventListener("click", () => {
                window.location.href = "index.html";
            });
        }
    </script>
</body>
</html>

