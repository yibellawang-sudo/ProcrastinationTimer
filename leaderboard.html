<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard - Procrastination Timer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Caveat:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap');
      
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f5e6d3;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4a574' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            padding: 2rem;
        }

        .falling-leaves {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 100;
        }

        .leaf-fall {
            position: absolute;
            font-size: 40px;
            animation: fall 12s infinite ease-in-out;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes fall {
            0% { top: -10%; opacity: 0; transform: translateX(0) rotate(0deg); }
            10% { opacity: 1; }
            50% { transform: translateX(100px) rotate(180deg); }
            90% { opacity: 1; }
            100% { top: 110%; opacity: 0; transform: translateX(-50px) rotate(360deg); }
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-family: 'Caveat', cursive;
            font-size: clamp(3rem, 7vw, 5rem);
            color: #d17842;
            text-shadow:
                3px 3px 0 #8b5a3c,
                6px 6px 0 rgba(0, 0, 0, 0.1);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .streak-badge {
            display: inline-block;
            background: linear-gradient(135deg, #d17842, #f5e6d3);
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            text-align: center;
            color: white;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            font-weight: 700;
            padding: 1rem 3rem;
            border-radius: 50px;
            border: 5px solid white;
            box-shadow: 
                0 8px 20px rgba(255, 157, 92, 0.5),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 1rem;
        }

        .back-button {
            display: block;
            margin-top: 3rem auto 0;
            background: linear-gradient(135deg, #d17842, #f5e6d3);
            color: white;
            box-shadow: 
                0 8px 0 rgba(0, 0, 0, 0.2),
                0 8px 20px rgba(0, 0, 0, 0.15);
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .back-button:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 16px 0 rgba(0,0,0,0.2), 0 16px 30px rgba(0,0,0,0.2);
        }

/*
        .current-streak {
            display: inline-block;
            background: linear-gradient(135deg, #ff6f61, #ff856f);
            color: white;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 111, 97, 0.3);
            margin: 1rem 0;
        } */

        .leaderboard-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 2fr 1fr 1.5fr 1.5fr;
            padding: 1rem;
            border-bottom: 1px solid #fff;
            align-items: center;
            transition: background 0.2s ease;
        }

        .leaderboard-row:hover {
            background: #fff3e6;
        }

        .leaderboard-row.header {
            background: linear-gradient(135deg, #d17842, #f5e6d3);
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.2);
        }

        .leaderboard-row.header:hover {
            background: linear-gradient(135deg, #d17842, #f5e6d3);
        }

        .rank {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }

        .rank.gold { color: #ffd700; }
        .rank.silver { color: #c0c0c0; }
        .rank.bronze { color: #cd7f32; }

        .score-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            font-family: 'Fredoka', sans-serif;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .score-excellent { background: #4caf50; color: white; }
        .score-good { background: #8bc34a; color: white; }
        .score-okay { background: #ffc107; color: white; }
        .score-poor { background: #ff9800; color: white; }
        .score-bad { background: #f44336; color: white; }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-style: italic;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 
                0 4px 12px rgba(0,0,0,0.1),
                inset 0 0 0 1px rgba(0, 0, 0, 0.05);
            border-radius: 15px;
            border: 1px solid #eee;
            transform: rotate(-1deg);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;
            animation: appear 0.6s ease-out backwards;
        }
        @keyframes appear {
            0% { opacity: 0; transform: rotate(-1deg) translateY(30px); }
            100% { opacity: 1; transform: rotate(-1deg) translateY(0); }
        }

        .stat-card:nth-child(2) {
            transform: rotate(1deg);
            animation-delay: 0.1s;
        }

        .stat-card:nth-child(3) {
            transform: rotate(-0.5deg);
            animation-delay: 0.2s;
        }

        .stat-card:hover {
            transform: rotate(0deg) translateY(-10px) scale(1.05);
            box-shadow:    
                0 15px 30px rgba(0, 0, 0, 0.25),
                0 0 15px rgba(255, 157, 92, 0.3);
            z-index: 10;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            font-size: 1.5rem;
            transform: rotate(45deg);
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .stat-label {
            font-family: 'Caveat', cursive;
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .stat-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            font-weight: bold;
            color: #d17842;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
        }

        .scrapbook-page {
            background: #fffef7;
            border-radius: 0;
            padding: 2.5rem;
            box-shadow: 
            0 2px 8px rgba(0,0,0,0.1),
            inset 0 0 0 1px rgba(139,90,60,0.1),
            8px 8px 0 rgba(209,120,66,0.15);
            position: relative;
            animation: pflip 1s ease-out backwards;
            border: 2px solid #e6d5c3;
            transform-origin: left center;
        }

        @keyframes pflip {
            0% { transform: perspective(1000px) rotateY(-90deg); opacity: 0; }
            100% { transform: perspective(1000px) rotateY(0deg); opacity: 1; }
        }

        .scrapbook-page::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 15%;
            width: 120px;
            height: 30px;
            background: repeating-linear-gradient(
            45deg,
            rgba(209,120,66,0.8),
            rgba(209,120,66,0.8) 10px,
            rgba(255,157,92,0.8) 10px,
            rgba(255,157,92,0.8) 20px
            );
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transform: rotate(-3deg);
        }

        h2 {
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Caveat', cursive;
            color: #d17842;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.05);
        }
        @media (max-width: 750px) {
            body {
                padding: 1rem;
            }
            .leaderboard-row {
                grid-template-columns: 60px 2fr 1fr 1fr 1fr;
                padding: 1rem;
                font-size: 1rem;
            }
            .rank {
                font-size: 1.5rem;
            }
            .scrapbook-page {
                padding: 1.5rem;
            }
        }

    </style>
</head>
<body>
    <div class="falling-leaves">
        <div class="leaf-fall" style="left: 10%; animation-delay: 0s;">🍂</div>
        <div class="leaf-fall" style="left: 30%; animation-delay: 3s;">🍁</div>
        <div class="leaf-fall" style="left: 50%; animation-delay: 6s;">🍂</div>
        <div class="leaf-fall" style="left: 70%; animation-delay: 2s;">🍁</div>
        <div class="leaf-fall" style="left: 85%; animation-delay: 8s;">🍂</div>
    </div>
    <div class="container">
        
        <div class="header">
            <h1>Your Leaderboard</h1>
            <div class="current-streak" id="streakDisplay">🔥 0 Day Streak</div>
        </div>

        <div class="summary-stats" id="summaryStats">
        </div>

        <div class="scrapbook-page">
            <h2>Last 7 Days Performance</h2>
            <div class="leaderboard-table">
                <div class="leaderboard-row header">
                    <div>Rank</div>
                    <div>Date</div>
                    <div>Score</div>
                    <div>Focus Time</div>
                    <div>Procrastination</div>
                </div>
                <div id="leaderboardBody">
                </div>
            </div>
        </div>

        <button class="back-button" id="backBtn">Back to Timer</button>
    </div>

    <script>
        function isElectron() {
            return typeof window !== "undefined" && typeof window.process === "object" && window.process.type === "renderer";
        }

        const backBtn = document.getElementById("backBtn");
        const streakDisplay = document.getElementById("streakDisplay");
        const leaderboardBody = document.getElementById("leaderboardBody");
        const summaryStats = document.getElementById("summaryStats");

        // Get data from localStorage
        const weeklyStats = JSON.parse(localStorage.getItem("weeklyStats")) || [];
        const streak = parseInt(localStorage.getItem("streak")) || 0;

        // Display streak
        streakDisplay.textContent = `🔥 ${streak} Day Streak`;

        // Calculate summary statistics
        function calculateSummaryStats() {
            if (weeklyStats.length === 0) return null;

            const last7Days = weeklyStats.slice(-7);
            const totalFocus = last7Days.reduce((sum, day) => sum + day.focus, 0);
            const totalProcrastination = last7Days.reduce((sum, day) => sum + day.procrastination, 0);
            const avgScore = Math.round(last7Days.reduce((sum, day) => sum + day.score, 0) / last7Days.length);
            const bestDay = last7Days.reduce((best, day) => day.score > best.score ? day : best, last7Days[0]);

            return { totalFocus, totalProcrastination, avgScore, bestDay };
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            if (h > 0) return `${h}h ${m}m`;
            return `${m}m`;
        }

        // Display summary stats
        const stats = calculateSummaryStats();
        if (stats) {
            summaryStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Focus (7d)</div>
                    <div class="stat-value">${formatTime(stats.totalFocus)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Score</div>
                    <div class="stat-value">${stats.avgScore}/100</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Day Score</div>
                    <div class="stat-value">${stats.bestDay.score}/100</div>
                </div>
            `;
        }

        // Get leaderboard data
        function getLeaderboardData() {
            const sortedStats = [...weeklyStats]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 7)
                .sort((a, b) => b.score - a.score); // Sort by score descending

            return sortedStats.map(day => ({
                date: new Date(day.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                score: day.score,
                focus: formatTime(day.focus),
                procrastination: formatTime(day.procrastination)
            }));
        }

        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 75) return 'score-good';
            if (score >= 60) return 'score-okay';
            if (score >= 40) return 'score-poor';
            return 'score-bad';
        }

        function getRankMedal(rank) {
            if (rank === 1) return '<span class="rank gold">🥇</span>';
            if (rank === 2) return '<span class="rank silver">🥈</span>';
            if (rank === 3) return '<span class="rank bronze">🥉</span>';
            return `<span class="rank">${rank}</span>`;
        }

        // Display leaderboard
        const leaderboardData = getLeaderboardData();
        
        if (leaderboardData.length === 0) {
            leaderboardBody.innerHTML = '<div class="no-data">No data yet. Complete some focus sessions to see your stats!</div>';
        } else {
            leaderboardBody.innerHTML = leaderboardData.map((day, index) => `
                <div class="leaderboard-row">
                    <div>${getRankMedal(index + 1)}</div>
                    <div>${day.date}</div>
                    <div><span class="score-badge ${getScoreClass(day.score)}">${day.score}/100</span></div>
                    <div>${day.focus}</div>
                    <div>${day.procrastination}</div>
                </div>
            `).join('');
        }

        // Navigation
        if (isElectron()) {
            const { ipcRenderer } = require("electron");
            backBtn.addEventListener("click", () => {
                ipcRenderer.send("navigate", "index.html");
            });
        } else {
            backBtn.addEventListener("click", () => {
                window.location.href = "index.html";
            });
        }
    </script>
</body>
</html>